# SPDX-FileCopyrightText: no
# SPDX-License-Identifier: CC0-1.0
#
# Configuration for the shell process job.
---

dontChroot: false

timeout: 1000

script:
    # Remove old dbs and db locks
    # - command: "rm -rf /var/lib/pacman/sync"
    #   timeout: 30
    - command: "-rm -f /var/lib/pacman/db.lck"
      timeout: 30

    # Remove temporary repository
    - command: sed -e '/\[xfce-minimal-iso\]/,+3d' -i /etc/pacman.conf
      timeout: 20
    
    # Setup keys and keyrings
    - command: "-pacman-key --init"
      timeout: 60
    - command: "-pacman-key --populate archlinux rebornos"
      timeout: 300
    - command: "-pacman -Sy --noconfirm archlinux-keyring"
      timeout: 300
    - command: "-pacman -Sy --noconfirm rebornos-keyring"
      timeout: 300    

    # Force update databases
    - command: "-pacman -Syy"
      timeout: 300 

    # Set up mkinitcpio.conf
    - command: mv -f /etc/mkinitcpio_offline.conf /etc/mkinitcpio.conf
      timeout: 45

    # Set up user config
    - command: cp -rf /home/rebornos/.config /etc/skel
      timeout: 600

i18n:
    name: "Performing initial configuration..."
